# TikTok 增强分析看板 - 功能说明

## 🎯 项目概述

这是一个增强版的 TikTok 数据分析看板，集成了基础信息展示、点击量分析和转化率分析功能。使用 Streamlit 和 Altair 构建，提供直观的数据可视化界面。

## 🚀 新功能特性

### 1. 基础信息展示
- **每日数据展示**: 展示每天每个账号的新增浏览量、发帖数、点赞数、评论数、分享数
- **分组视角**: 支持模糊匹配单个 group，展示 5 项数据的每日趋势图和堆叠柱图
- **多指标对比**: 支持多个指标的同时对比分析

### 2. 点击量分析
- **每日点击统计**: 统计每日总点击量、新增点击量和增长率
- **链接分组关联**: 将特定链接点击量与账号分组关联
  - `https://insnap.ai/videos` → `yujie_main_avatar` 分组
  - `https://insnap.ai/zh/download` → `wan_produce101` 分组
- **页面类型分析**: 按页面类型统计点击量分布

### 3. 转化率分析
- **点击到浏览转化**: 分析点击量与浏览量的转化关系
- **分组转化效率**: 分析不同分组的转化效率
- **相关性分析**: 点击量与各项指标的相关性分析

### 4. 可视化增强
- **Altair 图表**: 使用 Altair 替代 Plotly，提供更丰富的交互式图表
- **多维度展示**: 折线图、条形图、堆叠图、散点图等多种图表类型
- **响应式设计**: 支持不同屏幕尺寸的自适应布局

## 📁 项目结构

```
RedirectDataAnalysis/
├── dashboard/
│   ├── enhanced_app.py          # 增强版主应用
│   └── appDaily.py              # 原版应用（保留）
├── scripts/
│   ├── enhanced_data_processor.py    # 增强版数据处理器
│   ├── enhanced_visualization.py     # 增强版可视化工具
│   ├── fetch_accounts.py             # 账号数据获取脚本
│   └── fetch_redash.py               # Redash 数据获取脚本
├── config/
│   └── link_group_mapping.py         # 链接分组映射配置
├── data/
│   ├── redash_data/                  # Redash 数据文件
│   ├── postingManager_data/          # 账号详情数据
│   ├── clicks/                       # 点击数据
│   └── processed/                    # 处理后的数据
├── start_enhanced_dashboard.sh       # 增强版启动脚本
└── README_ENHANCED_FEATURES.md       # 功能说明文档
```

## 🛠️ 安装和运行

### 1. 环境准备
```bash
# 创建虚拟环境
python3 -m venv .venv

# 激活虚拟环境
source .venv/bin/activate  # macOS/Linux
# 或
.venv\Scripts\activate     # Windows

# 安装依赖
pip install streamlit pandas altair openpyxl numpy
```

### 2. 数据准备
确保以下数据文件存在：
- `data/redash_data/redash_data_*.csv` - Redash 数据文件
- `data/postingManager_data/accounts_detail.xlsx` - 账号详情数据
- `data/clicks/*.csv` - 点击数据文件

### 3. 启动应用

#### 方式一：使用启动脚本（推荐）
```bash
./start_enhanced_dashboard.sh
```

#### 方式二：直接运行
```bash
# 设置 Python 路径
export PYTHONPATH="${PYTHONPATH}:$(pwd)/scripts:$(pwd)/config"

# 启动应用
streamlit run dashboard/enhanced_app.py
```

## 📊 功能模块说明

### 1. 基础分析模块
- **数据概览**: 显示总记录数、账号数量、分组数量等关键指标
- **每日趋势**: 展示浏览量、发帖数等指标的每日变化趋势
- **多指标对比**: 同时展示多个指标的变化情况

### 2. 每日趋势模块
- **分组趋势**: 按分组展示各项指标的每日变化
- **堆叠面积图**: 直观显示不同分组的贡献度
- **分组对比**: 对比不同分组在同一时间点的表现

### 3. 点击分析模块
- **点击量趋势**: 展示每日点击量的变化趋势
- **页面类型统计**: 按页面类型统计点击量分布
- **链接点击统计**: 统计不同链接的点击量

### 4. 转化分析模块
- **转化率图表**: 展示点击到浏览的转化率变化
- **分组相关性**: 分析点击量与不同分组指标的相关性
- **转化效率**: 评估不同分组的转化效率

### 5. 数据详情模块
- **数据统计**: 显示详细的数据统计信息
- **数据预览**: 预览原始数据内容
- **数据下载**: 支持数据导出功能

## 🔧 配置说明

### 链接分组映射配置
在 `config/link_group_mapping.py` 中可以配置链接到分组的映射关系：

```python
LINK_GROUP_MAPPING = {
    'https://insnap.ai/videos': 'yujie_main_avatar',
    'https://insnap.ai/zh/download': 'wan_produce101',
    # 可以添加更多映射关系
}
```

### 分组筛选配置
支持使用以下分隔符进行分组拆分：
- 逗号 (,)
- 竖线 (|)
- 斜杠 (/)
- 分号 (;)
- 中文逗号 (，)
- 中文分号 (；)

## 📈 数据字段说明

### Redash 数据字段
- `user_id`: 用户ID
- `date`: 日期
- `view_count`: 浏览量
- `like_count`: 点赞数
- `comment_count`: 评论数
- `share_count`: 分享数
- `post_count`: 发帖数
- `view_diff`: 浏览量增量
- `like_diff`: 点赞数增量
- `comment_diff`: 评论数增量
- `share_diff`: 分享数增量
- `post_diff`: 发帖数增量

### Accounts 数据字段
- `Tiktok ID`: TikTok 用户ID
- `Groups`: 分组信息
- 其他账号详情字段

### Clicks 数据字段
- `timestamp`: 时间戳
- `page_url`: 页面链接
- `page_type`: 页面类型
- `session_id`: 会话ID
- `visitor_id`: 访客ID

## 🎨 可视化特性

### Altair 图表类型
1. **折线图**: 用于展示时间序列数据趋势
2. **条形图**: 用于分组对比分析
3. **堆叠面积图**: 用于展示分组贡献度
4. **散点图**: 用于相关性分析
5. **热力图**: 用于效率指标展示

### 交互功能
- **工具提示**: 鼠标悬停显示详细数据
- **缩放和平移**: 支持图表缩放和移动
- **筛选**: 支持按日期和分组筛选数据
- **导出**: 支持图表和数据导出

## 🔍 使用技巧

### 1. 数据筛选
- 使用侧边栏的日期选择器选择时间范围
- 使用分组多选框选择要分析的分组
- 支持模糊匹配，输入部分分组名称即可

### 2. 图表交互
- 鼠标悬停在图表上查看详细数据
- 使用图表工具栏进行缩放、平移等操作
- 点击图例可以隐藏/显示特定数据系列

### 3. 数据导出
- 在数据详情页面可以下载原始数据
- 支持 CSV 格式导出
- 文件名包含导出时间戳

## 🐛 故障排除

### 常见问题

1. **数据加载失败**
   - 检查数据文件是否存在
   - 确认文件格式是否正确
   - 查看控制台错误信息

2. **图表显示异常**
   - 检查数据是否为空
   - 确认数据格式是否正确
   - 尝试刷新页面

3. **性能问题**
   - 减少数据筛选范围
   - 关闭不必要的标签页
   - 检查数据文件大小

### 日志查看
应用运行时会输出详细的日志信息，包括：
- 数据加载状态
- 处理进度
- 错误信息

## 📞 技术支持

如果遇到问题，请：
1. 查看控制台错误信息
2. 检查数据文件格式
3. 确认依赖包版本
4. 查看项目文档

## 🔄 版本更新

### v2.0.0 (当前版本)
- ✅ 新增点击量分析功能
- ✅ 新增转化率分析功能
- ✅ 升级到 Altair 可视化
- ✅ 增强分组筛选功能
- ✅ 新增数据导出功能

### 计划功能
- [ ] 实时数据更新
- [ ] 更多图表类型
- [ ] 自定义仪表板
- [ ] 数据预警功能
- [ ] 多语言支持 